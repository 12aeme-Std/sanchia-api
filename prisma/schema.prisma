generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id          Int      @id @default(autoincrement())
    name        String
    lastname    String
    email       String   @unique
    password    String
    accessToken String?  @map("acccess_token")
    role        Roles    @default(SELLER)
    createdAt   DateTime @default(now()) @map("created_at")
    updatedAt   DateTime @updatedAt() @map("updated_at")

    carts              Cart[]
    orders             Order[]
    PreOrders          PreOrder[]
    warehouseMovements WarehouseMovement[]

    @@map("user")
}

model Product {
    id          Int      @id @default(autoincrement())
    name        String   @unique
    description String
    price       Float
    stock       Int
    createdAt   DateTime @default(now()) @map("created_at")
    updatedAt   DateTime @updatedAt() @map("updated_at")

    category   Category @relation(fields: [categoryId], references: [id])
    categoryId Int      @map("category_id")

    images           Image[]
    productsCarts    ProductsCarts[]
    productsOrders   ProductsOrders[]
    promosProducts   PromosProducts[]
    preorderProducts PreorderProducts[]

    @@map("product")
}

model Image {
    id Int @id @default(autoincrement())

    url        String
    isCover    Boolean  @map("is_cover")
    uploadedAt DateTime @default(now()) @map("uploaded_at")

    product   Product @relation(fields: [productId], references: [id])
    productId Int     @map("product_id")

    @@map("image")
}

model Category {
    id   Int    @id @default(autoincrement())
    name String @unique

    products Product[]

    @@map("category")
}

model Cart {
    id Int @id @default(autoincrement())

    productsCarts ProductsCarts[]

    user   User? @relation(fields: [userId], references: [id])
    userId Int   @map("user_id")

    @@map("cart")
}

model Order {
    id    Int   @id @default(autoincrement())
    total Float @default(0)

    orderedAt DateTime @default(now()) @map("ordered_at")

    user   User? @relation(fields: [userId], references: [id])
    userId Int   @map("user_id")

    productsOrders ProductsOrders[]

    promosOrders PromosOrders?

    @@map("order")
}

model PreOrder {
    id    Int   @id @default(autoincrement())
    total Float @default(0)

    orderedAt DateTime @default(now()) @map("ordered_at")

    user   User? @relation(fields: [userId], references: [id])
    userId Int   @map("user_id")

    preorderProducts PreorderProducts[]

    @@map("pre_order")
}

model Promo {
    id        Int       @id @default(autoincrement())
    name      String
    type      PromoType
    amount    Int
    isEnable  Boolean   @map("is_enable")
    applyTo   ApplyTo   @map("apply_to")
    startDate DateTime  @default(now()) @map("start_date")
    endDate   DateTime  @default(now()) @map("end_date")

    promosProducts PromosProducts?
    promoOrders    PromosOrders?

    @@map("promo")
}

model PreorderProducts {
    quantity Int

    preOrder   PreOrder @relation(fields: [preorderId], references: [id])
    preorderId Int      @map("preorder_id")

    product   Product @relation(fields: [productId], references: [id])
    productId Int     @map("product_id")

    @@id([preorderId, productId])
    @@map("preorders_products")
}

model ProductsCarts {
    quantity Int

    cart   Cart @relation(fields: [cartId], references: [id])
    cartId Int  @map("cart_id")

    product   Product @relation(fields: [productId], references: [id])
    productId Int     @map("product_id")

    @@id([cartId, productId])
    @@map("products_carts")
}

model ProductsOrders {
    quantity Int

    order   Order @relation(fields: [orderId], references: [id])
    orderId Int   @map("order_id")

    product   Product @relation(fields: [productId], references: [id])
    productId Int     @map("product_id")

    @@id([orderId, productId])
    @@map("products_orders")
}

model PromosProducts {
    product   Product @relation(fields: [productId], references: [id])
    productId Int     @map("product_id")

    promo   Promo @relation(fields: [promoId], references: [id])
    promoId Int   @unique @map("promo_id")

    @@id([productId, promoId])
    @@map("promos_products")
}

model PromosOrders {
    order   Order @relation(fields: [orderId], references: [id])
    orderId Int   @unique @map("order_id")

    promo   Promo @relation(fields: [promoId], references: [id])
    promoId Int   @unique @map("promo_id")

    @@id([orderId, promoId])
    @@map("promos_orders")
}

model Warehouse {
    id        Int      @id @default(autoincrement())
    name      String   @unique
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt() @map("updated_at")

    rawMaterials                  RawMaterial[]
    warehouseMovementOrigins      WarehouseMovement[] @relation("origin")
    warehouseMovementDestinations WarehouseMovement[] @relation("destination")

    @@map("warehouse")
}

model WarehouseMovement {
    id        Int           @id @default(autoincrement())
    quantity  Int
    type      WarehouseType
    createdAt DateTime      @default(now()) @map("created_at")

    users  User @relation(fields: [userId], references: [id])
    userId Int  @map("user_id")

    machienes Machine @relation(fields: [machineId], references: [id])
    machineId Int     @map("machine_id")

    mixtures  Mixture @relation(fields: [mixtureId], references: [id])
    mixtureId Int     @map("mixtures_id")

    rawMaterial   RawMaterial @relation(fields: [rawMaterialId], references: [id])
    rawMaterialId Int         @map("raw_material_id")

    warehouseOrigin   Warehouse @relation(fields: [warehouseOriginId], references: [id], name: "origin")
    warehouseOriginId Int       @map("warehouse_origin_id")

    warehouseDestination   Warehouse @relation(fields: [warehouseDestinationId], references: [id], name: "destination")
    warehouseDestinationId Int       @map("warehouse_destination_id")

    @@map("warehouse_movement")
}

model Machine {
    id        Int      @id @default(autoincrement())
    createdAt DateTime @default(now()) @map("created_at")
    name      String   @unique

    MachineProcess    MachineProcess[]
    WarehouseMovement WarehouseMovement[]
    Manufacture       Manufacture[]

    @@map("machine")
}

model MachineProcess {
    id Int @id @default(autoincrement())

    createdAt  DateTime @default(now()) @map("created_at")
    finishedAt DateTime @default(now()) @map("finished_at")

    machine   Machine @relation(fields: [machineId], references: [id])
    machineId Int     @map("machine_id")

    MixMachine MixMachine[]

    @@map("machine_process")
}

model MixMachine {
    id       Int @id @default(autoincrement())
    quantity Int

    mixture   Mixture @relation(fields: [mixtureId], references: [id])
    mixtureId Int     @map("mixture_id")

    machineProcess   MachineProcess @relation(fields: [machineProcessId], references: [id])
    machineProcessId Int            @map("machine_process_id")

    @@map("mix_machine")
}

model Mixture {
    id   Int    @id @default(autoincrement())
    name String @unique

    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt() @map("updated_at")

    Recipes           Recipe[]
    MixMachines       MixMachine[]
    MixtureMaterial   MixtureMaterial[]
    WarehouseMovement WarehouseMovement[]

    @@map("mixture")
}

model MixtureMaterial {
    id       Int @id @default(autoincrement())
    quantity Int

    mixture   Mixture @relation(fields: [mixtureId], references: [id])
    mixtureId Int

    rawMaterial RawMaterial @relation(fields: [rawMaterialId], references: [id])
    rawMaterialId Int @map("raw_material_id")
}

model RawMaterial {
    id        Int      @id @default(autoincrement())
    name      String   @unique
    quantity  Int
    type RawMaterialType @default(RAW)
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt() @map("updated_at")

    warehouse   Warehouse @relation(fields: [warehouseId], references: [id])
    warehouseId Int       @map("warehouse_id")

    Manufactures       Manufacture[]
    WarehouseMovements WarehouseMovement[]
    Recipes            Recipe[]

    MixtureMaterial MixtureMaterial[]

    @@map("raw_material")
}

model Manufacture {
    id        Int               @id @default(autoincrement())
    status    ManufactureStatus

    createdAt DateTime          @default(now()) @map("created_at")
    updatedAt DateTime          @updatedAt() @map("updated_at")

    machine   Machine @relation(fields: [machineId], references: [id])
    machineId Int     @map("machine_id")

    rawMaterial   RawMaterial @relation(fields: [rawMaterialId], references: [id])
    rawMaterialId Int         @map("raw_material_id")

    manufactureProduct   ManufactureProduct @relation(fields: [manufactureProductId], references: [id])
    manufactureProductId Int                @map("manufacture_product_id")

    @@map("manufacture")
}

model ManufactureProduct {
    id        Int      @id @default(autoincrement())
    name      String
    quantity Int
    createdAt DateTime @default(now()) @map("created_at")

    manufactures Manufacture[]

    @@map("manufacture_product")
}


model Recipe {
    id          Int    @id @default(autoincrement())
    name        String @unique
    description String
    quantity    Float

    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    rawMaterial   RawMaterial @relation(fields: [rawMaterialId], references: [id])
    rawMaterialId Int         @map("raw_material_id")

    mixture   Mixture @relation(fields: [mixtureId], references: [id])
    mixtureId Int     @map("mixture_id")

    @@map("recipe")
}

enum Roles {
    ADMIN
    SELLER
    SUPERVISOR
    PROVIDER
    CLIENT

    @@map("roles")
}

enum PromoType {
    PERCENTAGE
    MONEY

    @@map("promo_type")
}

enum ApplyTo {
    ORDER
    PRODUCT

    @@map("apply_to")
}

enum WarehouseType {
    PRODUCT
    MIX

    @@map("warehouse_type")
}

enum RawMaterialType {
    PRODUCT
    RAW

    @@map("raw_materials")
}

enum ManufactureStatus {
    PRODUCT
    PRODUCTION
    REFUSE
    REJECTED

    @@map("manufacture_status")
}
